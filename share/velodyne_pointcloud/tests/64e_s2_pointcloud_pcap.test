<!-- rostest of publishing a PointCloud from 64E S2.1 PCAP data. -->
<!-- 
    run this test by follow steps: 
    $ cd path/to/ros_workspace 
    $ catkin_make 
    $ source devel/setup.bash 
    $ roslaunch velodyne_pointcloud 64e_s2_pointcloud_pcap.test 
-->


<launch>

  <include file="$(find velodyne_pointcloud)/launch/nodelet_manager.launch">
  </include>
  
    <!-- start nodelet manager and driver nodelets -->
  <include file="$(find velodyne_driver)/launch/driver_nodelet.launch">
    <arg name="model" value="64E_S2"/>
    <arg name="pcap" value="$(find velodyne_pointcloud)/tests/64e_s2.pcap"/>
    <arg name="rpm" value="300"/>
  </include>
  
  <!-- start cloud nodelet using test calibration file -->
  <include file="$(find velodyne_pointcloud)/launch/cloud_nodelet.launch">
    <arg name="model" default="64E_S2" />
    <arg name="calibration" default="$(find velodyne_pointcloud)/params/64e_test.yaml" />
    <arg name="organized" default="true"/>
    <arg name="min_range" default="5.0" />
    <arg name="max_range" default="70.0" />
    <arg name="imu_sync" default="xsens" />
  </include>
  
  <include file="$(find velodyne_pointcloud)/launch/pointcloud_save_nodelet.launch">
    <arg name="save_folder" default="$(find velodyne_pointcloud)/tests/velodyne_test_msg_files" />
    <arg name="topic_name" default="/dusensor/velodyne/points" />
    <arg name="file_prefix" default="64e_out_pcap_" />
  </include>

  <!-- verify PointCloud2 convert -->
  <node pkg="velodyne_pointcloud" type="verify_pointcloud" name="verify_pointcloud" output="screen" required="true">
    <param name="run_save_folder" value="$(find velodyne_pointcloud)/tests/velodyne_test_msg_files"/>
    <param name="expected_save_folder" value="$(find velodyne_pointcloud)/tests/velodyne_test_msg_files"/>
    <param name="run_file_prefix" value="64e_out_pcap_"/>
    <param name="expected_file_prefix" value="ordered_out_pcap_msg_"/>
    <param name="start_seq" value="1213057740" />
    <param name="end_seq" value="1213057740" />
    <param name="wait_time" value="10" />
  </node>

</launch>
